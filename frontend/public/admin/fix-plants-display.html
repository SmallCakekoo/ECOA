<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arreglar Visualizaci√≥n de Plantas - ECOA Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .plant-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .plant-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .plant-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .plant-info {
            flex: 1;
        }
        .plant-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        .plant-info p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #e9ecef;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Arreglar Visualizaci√≥n de Plantas - ECOA Admin</h1>
        <p>Este script modifica el c√≥digo del dashboard para mostrar las plantas correctamente con las columnas que realmente existen.</p>
        
        <button onclick="checkPlantsStructure()">üîç Verificar Estructura de Plantas</button>
        <button onclick="fixDashboardCode()">üîß Arreglar C√≥digo del Dashboard</button>
        <button onclick="testFixedDisplay()">üß™ Probar Visualizaci√≥n Corregida</button>
        
        <div id="structureResult" class="result"></div>
        <div id="fixResult" class="result"></div>
        <div id="testResult" class="result"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3001';
        
        async function checkPlantsStructure() {
            const resultDiv = document.getElementById('structureResult');
            resultDiv.innerHTML = 'üîÑ Verificando estructura de plantas...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/plants`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const plants = data.data;
                    let html = `<h3>üìã Estructura Real de la Tabla Plants</h3>`;
                    
                    if (plants.length > 0) {
                        const firstPlant = plants[0];
                        html += `<h4>Columnas disponibles:</h4>`;
                        html += `<pre>${JSON.stringify(firstPlant, null, 2)}</pre>`;
                        
                        html += `<h4>Plantas encontradas:</h4>`;
                        plants.forEach(plant => {
                            html += `
                                <div class="plant-card">
                                    <div class="plant-image">
                                        <img src="../../src/plant-placeholder.svg" alt="${plant.name}">
                                    </div>
                                    <div class="plant-info">
                                        <h4>${plant.name} (${plant.species})</h4>
                                        <p>ID: ${plant.id}</p>
                                        <p>Adoptada: ${plant.is_adopted ? 'S√≠' : 'No'}</p>
                                        <p>Fecha: ${new Date(plant.registration_date).toLocaleDateString()}</p>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.message || 'No se pudieron cargar las plantas'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error de conexi√≥n: ${error.message}</div>`;
            }
        }
        
        function fixDashboardCode() {
            const resultDiv = document.getElementById('fixResult');
            resultDiv.innerHTML = 'üîß Generando c√≥digo corregido...';
            
            const fixedCode = `
// C√≥digo corregido para dashboard.js - funci√≥n loadRecentPlants
async function loadRecentPlants() {
  try {
    // Cargar todas las plantas sin filtro de status
    const response = await window.AdminAPI.getPlants();
    const plants = response.data.slice(0, 5); // √öltimas 5 plantas
    
    const container = document.getElementById('recentPlants');
    if (container) {
      // Crear encabezados de tabla
      const tableHeaders = \`
        <div class="plant-item plant-header-row">
          <div class="plant-image"></div>
          <div class="plant-info">PLANT</div>
          <div class="adopter-info">ADOPTER</div>
          <div class="status-cell">STATUS</div>
          <div class="care-notes">CARE NOTES</div>
        </div>
      \`;
      
      // Crear filas de plantas usando las columnas que S√ç existen
      const plantRows = plants.map(plant => \`
        <div class="plant-item">
          <div class="plant-image">
            <img src="../../src/plant-placeholder.svg" 
                 alt="\${plant.name}" 
                 style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px;">
          </div>
          <div class="plant-info">
            <h4>\${plant.name} #\${String(plant.id).padStart(6, '0')}</h4>
            <p>\${plant.species}</p>
          </div>
          <div class="adopter-info">\${plant.is_adopted ? 'Adopted' : 'Available'}</div>
          <div class="status-cell">
            <span class="status healthy">\${plant.is_adopted ? 'Adopted' : 'Available'}</span>
          </div>
          <div class="care-notes">\${plant.description || 'No recent notes'}</div>
        </div>
      \`).join('');
      
      container.innerHTML = tableHeaders + plantRows;
    }
  } catch (error) {
    console.error('Error loading recent plants:', error);
    const container = document.getElementById('recentPlants');
    if (container) {
      container.innerHTML = '<p>Error loading plants</p>';
    }
  }
}
            `;
            
            resultDiv.innerHTML = `
                <div class="success">
                    <h3>‚úÖ C√≥digo Corregido Generado</h3>
                    <p>Este c√≥digo usa las columnas que realmente existen en la tabla plants:</p>
                    <ul>
                        <li><strong>name</strong> - Nombre de la planta</li>
                        <li><strong>species</strong> - Especie</li>
                        <li><strong>is_adopted</strong> - Si est√° adoptada o disponible</li>
                        <li><strong>description</strong> - Descripci√≥n (si existe)</li>
                        <li><strong>id</strong> - ID √∫nico</li>
                    </ul>
                    <p><strong>Nota:</strong> Usa placeholder SVG porque no hay columna image_url</p>
                    <details>
                        <summary>Ver c√≥digo completo</summary>
                        <pre>${fixedCode}</pre>
                    </details>
                </div>
            `;
        }
        
        function testFixedDisplay() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = 'üß™ Probando visualizaci√≥n corregida...';
            
            // Simular la visualizaci√≥n corregida
            const mockPlants = [
                {
                    id: "8bb81b43-77ee-452e-92b9-1991ac13154c",
                    name: "Luna",
                    species: "Ficus lyrata",
                    is_adopted: false,
                    description: "Hermosa planta de interior"
                },
                {
                    id: "bc847426-4203-4d18-aa12-21864906fe08",
                    name: "Sol",
                    species: "Monstera deliciosa",
                    is_adopted: true,
                    description: "Planta tropical resistente"
                }
            ];
            
            let html = `<h3>üß™ Vista Previa de la Visualizaci√≥n Corregida</h3>`;
            
            mockPlants.forEach(plant => {
                html += `
                    <div class="plant-card">
                        <div class="plant-image">
                            <img src="../../src/plant-placeholder.svg" 
                                 alt="${plant.name}" 
                                 style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px;">
                        </div>
                        <div class="plant-info">
                            <h4>${plant.name} #${String(plant.id).padStart(6, '0')}</h4>
                            <p>${plant.species}</p>
                        </div>
                        <div style="flex: 1;">
                            <strong>Adopter:</strong> ${plant.is_adopted ? 'Adopted' : 'Available'}<br>
                            <strong>Status:</strong> ${plant.is_adopted ? 'Adopted' : 'Available'}<br>
                            <strong>Care Notes:</strong> ${plant.description || 'No recent notes'}
                        </div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
        }
        
        // Cargar estructura autom√°ticamente al abrir la p√°gina
        window.onload = checkPlantsStructure;
    </script>
</body>
</html>
